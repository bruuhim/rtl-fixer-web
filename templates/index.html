<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTL Subtitle Fixer</title>
    <meta name="description" content="Instantly fix right-to-left (RTL) text issues in your .ASS and .SRT subtitle files.">
    <meta property="og:title" content="RTL Subtitle Fixer">
    <meta property="og:description" content="Upload your subtitle files and fix RTL text issues instantly.">
    <meta name="theme-color" content="#1e293b">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-gradient-start: #1e293b;
            --bg-gradient-end: #475569;
            --container-bg: rgba(30, 41, 59, 0.95);
            --text-title: #f1f5f9;
            --text-body: #94a3b8;
            --border-color: rgba(71, 85, 105, 0.5);
            --dashed-border-color: #475569;
            --upload-area-bg: rgba(51, 65, 85, 0.5);
            --file-item-bg: rgba(51, 65, 85, 0.8);
            --footer-border-color: #334155;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end)); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; position: relative; overflow-x: hidden; transition: font-family 0.3s ease; }
        html[dir="rtl"] body { font-family: 'Tajawal', sans-serif; }
        .lang-ar { display: none; }
        html[lang="ar"] .lang-en { display: none; }
        html[lang="ar"] .lang-ar { display: inline; }
        .lang-switch-container { position: absolute; top: 20px; right: 20px; display: flex; align-items: center; gap: 10px; color: white; font-size: 0.9rem; z-index: 10; }
        .lang-switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .lang-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #475569; transition: .4s; border-radius: 26px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #667eea; }
        input:checked + .slider:before { transform: translateX(24px); }
        .background-pattern { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.1; background-image: radial-gradient(circle at 25% 25%, rgba(255,255,255,0.2) 2px, transparent 2px), radial-gradient(circle at 75% 75%, rgba(255,255,255,0.2) 2px, transparent 2px); background-size: 60px 60px; animation: float 20s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0px) rotate(0deg); } 50% { transform: translateY(-20px) rotate(1deg); } }
        .container { background: var(--container-bg); backdrop-filter: blur(20px); border-radius: 24px; box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15); padding: 40px; width: 100%; max-width: 600px; position: relative; z-index: 1; border: 1px solid var(--border-color); }
        .header { text-align: center; margin-bottom: 40px; }
        .title { font-size: 2.5rem; font-weight: 800; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 8px; line-height: 1.2; }
        .subtitle { color: var(--text-body); font-size: 1.1rem; font-weight: 500; }
        .upload-area { border: 2px dashed var(--dashed-border-color); border-radius: 16px; padding: 60px 20px; text-align: center; transition: all 0.3s; background: var(--upload-area-bg); position: relative; overflow: hidden; cursor: pointer; }
        .upload-area:hover, .upload-area:focus { outline: none; border-color: #667eea; background: rgba(102, 126, 234, 0.05); transform: translateY(-2px); }
        .upload-text { font-size: 1.2rem; font-weight: 600; color: var(--text-title); margin-bottom: 8px; }
        .upload-subtext { color: var(--text-body); font-size: 0.95rem; margin-bottom: 20px; }
        .file-input { display: none; }
        .browse-button { display: inline-flex; align-items: center; gap: 8px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 12px 24px; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-decoration: none; font-size: 0.95rem; }
        .file-list { margin-top: 30px; display: none; }
        .file-item { display: flex; align-items: center; gap: 12px; padding: 16px; background: var(--file-item-bg); border-radius: 12px; margin-bottom: 12px; border: 1px solid rgba(226, 232, 240, 0.1); }
        html[dir="rtl"] .file-item { text-align: right; }
        .file-icon { width: 40px; height: 40px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.8rem; }
        .file-name { font-weight: 600; color: var(--text-title); margin-bottom: 2px; }
        .file-size { font-size: 0.85rem; color: var(--text-body); }
        .remove-button { background: #ef4444; color: white; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; }
        .process-button { width: 100%; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; padding: 16px; border-radius: 12px; font-size: 1.1rem; font-weight: 600; cursor: pointer; margin-top: 20px; transition: all 0.3s ease; display: none; }
        .process-button:disabled { background: #9ca3af; cursor: not-allowed; }
        .progress-bar { width: 100%; height: 8px; background: rgba(226, 232, 240, 0.8); border-radius: 4px; margin-top: 20px; overflow: hidden; display: none; }
        .progress-fill { height: 100%; background: linear-gradient(135deg, #10b981, #059669); width: 0%; transition: width 0.3s ease; border-radius: 4px; }
        .status-message { text-align: center; margin-top: 16px; font-weight: 500; display: none; }
        .success { color: #059669; } .error { color: #dc2626; } .processing { color: #667eea; }
        .footer-credit { text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--footer-border-color); font-size: 0.9rem; color: var(--text-body); }
        .footer-credit a { color: var(--text-body); font-weight: 600; text-decoration: none; transition: color 0.2s ease; }
        .footer-credit a:hover { color: var(--text-title); text-decoration: underline; }
    </style>
</head>
<body>
    <div class="background-pattern"></div>
    <div class="lang-switch-container">
        <span class="lang-en">EN</span>
        <span class="lang-ar">AR</span>
        <label class="lang-switch">
            <input type="checkbox" id="languageToggle">
            <span class="slider"></span>
        </label>
    </div>
    <div class="container">
        <div class="header">
            <h1 class="title"><span class="lang-en">RTL Subtitle Fixer</span><span class="lang-ar">Ù…ÙØµÙ„Ø­ Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ±Ø¬Ù…Ø©</span></h1>
            <p class="subtitle"><span class="lang-en">Upload your subtitle files and fix RTL text issues instantly</span><span class="lang-ar">Ø§Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ±Ø¬Ù…Ø© ÙˆØ£ØµÙ„Ø­ Ù…Ø´Ø§ÙƒÙ„ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù†Øµ ÙÙˆØ±Ø§Ù‹</span></p>
        </div>
        <form id="uploadForm" enctype="multipart/form-data">
            <div class="upload-area" id="uploadArea" role="button" tabindex="0">
                <div class="upload-icon"><svg width="40" height="40" fill="white" viewBox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/></svg></div>
                <div class="upload-text"><span class="lang-en">Drop your ASS or SRT files here</span><span class="lang-ar">Ø§Ø³Ø­Ø¨ Ù…Ù„ÙØ§Øª ASS Ø£Ùˆ SRT Ø¥Ù„Ù‰ Ù‡Ù†Ø§</span></div>
                <div class="upload-subtext"><span class="lang-en">or click to browse and select multiple files</span><span class="lang-ar">Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø³ØªØ¹Ø±Ø§Ø¶ ÙˆØªØ­Ø¯ÙŠØ¯ Ø¹Ø¯Ø© Ù…Ù„ÙØ§Øª</span></div>
                <button type="button" class="browse-button" id="browseButton"><svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/></svg><span class="lang-en">Browse Files</span><span class="lang-ar">Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª</span></button>
                <input type="file" id="fileInput" name="files" multiple accept=".ass,.srt" class="file-input">
            </div>
            <div class="file-list" id="fileList"></div>
            <button type="submit" class="process-button" id="processButton"><svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24" style="margin-right: 8px;"><path d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"/></svg><span class="lang-en">Process Files</span><span class="lang-ar">Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª</span></button>
            <div class="progress-bar" id="progressBar"><div class="progress-fill" id="progressFill"></div></div>
            <div class="status-message" id="statusMessage"></div>
        </form>
        <div class="footer-credit"><span class="lang-en">Designed By</span><span class="lang-ar">ØªØµÙ…ÙŠÙ…</span> <a href="https://x.com/bruuhim" target="_blank" rel="noopener noreferrer">@bruuhim</a></div>
    </div>

    <script>
        const translations = {
            error_select_files: { en: "Please select ASS or SRT subtitle files only.", ar: "ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…Ù„ÙØ§Øª ØªØ±Ø¬Ù…Ø© Ù…Ù† Ù†ÙˆØ¹ ASS Ø£Ùˆ SRT ÙÙ‚Ø·." },
            error_process: { en: "Please select files to process.", ar: "ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…Ù„ÙØ§Øª Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©." },
            status_processing: { en: "ğŸ”„ Processing files...", ar: "ğŸ”„ Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª..." },
            status_success: { en: "âœ… Files processed successfully! Download started.", ar: "âœ… ØªÙ…Øª Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­! Ø¨Ø¯Ø£ Ø§Ù„ØªÙ†Ø²ÙŠÙ„." },
            status_error: { en: "âŒ Error processing files. Please try again.", ar: "âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰." }
        };

        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const processButton = document.getElementById('processButton');
        const uploadForm = document.getElementById('uploadForm');
        const browseButton = document.getElementById('browseButton');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const statusMessage = document.getElementById('statusMessage');
        const languageToggle = document.getElementById('languageToggle');
        
        let selectedFiles = [];
        let currentLang = 'en';

        function setLanguage(lang) {
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            currentLang = lang;
            localStorage.setItem('language', lang);
            languageToggle.checked = lang === 'ar';
        }

        languageToggle.addEventListener('change', (e) => {
            setLanguage(e.target.checked ? 'ar' : 'en');
        });

        document.addEventListener('DOMContentLoaded', () => {
            const savedLang = localStorage.getItem('language') || 'en';
            setLanguage(savedLang);
        });

        browseButton.addEventListener('click', (e) => { e.stopPropagation(); fileInput.click(); });
        uploadArea.addEventListener('click', () => fileInput.click(); });
        uploadArea.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); fileInput.click(); } });
        uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.classList.add('dragover'); });
        uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
        uploadArea.addEventListener('drop', (e) => { e.preventDefault(); uploadArea.classList.remove('dragover'); addFiles(Array.from(e.dataTransfer.files)); });
        fileInput.addEventListener('change', (e) => { if (e.target.files.length > 0) addFiles(Array.from(e.target.files)); });
        uploadForm.addEventListener('submit', handleFormSubmit);

        function addFiles(newFiles) {
            const subtitleFiles = newFiles.filter(file => { const n = file.name.toLowerCase(); return n.endsWith('.ass') || n.endsWith('.srt'); });
            if (subtitleFiles.length === 0 && selectedFiles.length === 0) { showStatus(translations.error_select_files[currentLang], 'error'); return; }
            const existingFileNames = new Set(selectedFiles.map(f => f.name));
            const uniqueNewFiles = subtitleFiles.filter(f => !existingFileNames.has(f.name));
            selectedFiles = [...selectedFiles, ...uniqueNewFiles];
            renderFileList();
            if (selectedFiles.length > 0) { processButton.style.display = 'block'; hideStatus(); }
            fileInput.value = null;
        }

        function renderFileList() {
            if (selectedFiles.length === 0) { fileList.style.display = 'none'; processButton.style.display = 'none'; return; }
            fileList.style.display = 'block';
            fileList.innerHTML = selectedFiles.map((file, index) => {
                const extension = file.name.split('.').pop().toUpperCase();
                return `
                <div class="file-item">
                    <div class="file-icon">${extension}</div>
                    <div class="file-info"><div class="file-name">${file.name}</div><div class="file-size">${formatFileSize(file.size)}</div></div>
                    <button type="button" class="remove-button" onclick="removeFile(${index})" aria-label="Remove ${file.name}"><svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/></svg></button>
                </div>`;
            }).join('');
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            renderFileList();
        }

        async function handleFormSubmit(e) {
            e.preventDefault();
            if (selectedFiles.length === 0) { showStatus(translations.error_process[currentLang], 'error'); return; }
            const formData = new FormData();
            selectedFiles.forEach(file => formData.append('files', file));
            processButton.disabled = true;
            progressBar.style.display = 'block';
            progressFill.style.width = '0%';
            showStatus(translations.status_processing[currentLang], 'processing');
            try {
                const response = await fetch('/', { method: 'POST', body: formData });
                progressFill.style.width = '100%';
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    const disposition = response.headers.get('Content-Disposition');
                    let downloadName = 'fixed_files.zip';
                    if (disposition && disposition.indexOf('attachment') !== -1) {
                        const filenameRegex = /filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;
                        const matches = filenameRegex.exec(disposition);
                        if (matches != null && matches[1]) { downloadName = matches[1].replace(/['"]/g, ''); }
                    }
                    a.download = downloadName;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    showStatus(translations.status_success[currentLang], 'success');
                    setTimeout(() => {
                        selectedFiles = [];
                        renderFileList();
                        progressBar.style.display = 'none';
                        progressFill.style.width = '0%';
                        hideStatus();
                    }, 4000);
                } else {
                    const errorText = await response.text();
                    console.error("Server Error:", errorText);
                    throw new Error(`Processing failed: ${response.statusText}`);
                }
            } catch (error) {
                showStatus(translations.status_error[currentLang], 'error');
                console.error('Fetch Error:', error);
            } finally {
                processButton.disabled = false;
            }
        }
        
        function formatFileSize(bytes) { if (bytes === 0) return '0 Bytes'; const k = 1024; const i = Math.floor(Math.log(bytes) / Math.log(k)); return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + ['Bytes', 'KB', 'MB', 'GB', 'TB'][i]; }
        function showStatus(message, type) { statusMessage.textContent = message; statusMessage.className = `status-message ${type}`; statusMessage.style.display = 'block'; }
        function hideStatus() { statusMessage.style.display = 'none'; }
    </script>
</body>
</html>
